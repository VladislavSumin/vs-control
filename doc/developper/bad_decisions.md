# Плохие решения в проекте.

Тут содержатся описания плохих решений которые хочется исправить, но в данный момент не существует лучшего решения, ну
или просто не придумали как сделать лучше.

## Gradle.

Плохие решения связанные с gradle.

### Проброс каталогов версий в convention плагины.

Гредл предоставляет dsl для получения зависимостей из каталогов версий внутри convention
плагинов [тырк](https://docs.gradle.org/8.5/release-notes.html#catalog-precompiled), однако это апи позволяет получать
доступ к зависимостям только по строковым ключам, что нас не устраивает. На эту проблему
заведена [ишуя](https://github.com/gradle/gradle/issues/15383), но адекватных решений пока нет.

В качестве митигации проблемы используется один из костылей предложенных в
ишуе [тырк](../../build-logic/build.gradle.kts). Данное решение позволяет получить нормальны доступ к каталогам версий в
convention плагинах, но мы платим за это сбросом кеша плагинов при изменении каталогов версий.

### Detekt в build-logic модуле.

В build-logic нельзя использовать convention плагины написанные в самом этом модуле, но есть желание прогонять detekt, в
том числе и для этого модуля. Тут существует несколько решений, как со стульями только их три:

* Сделать еще один вложенный модуль с билд логикой, так делают в некоторых репозиториях, но при таком подходе если мы
  захотим проверить детектом код в этом модуле то у нас случится бесконечная рекурсия.
* Скопировать конфигурацию detekt отдельно в конфигурации build-logic, можно, но это копипаста конфига.
* Сделать отдельный convention
  плагин [тык](../../build-logic/src/main/kotlin/ru/vs/convention/analyze/detekt-build-logic.gradle.kts), который будет
  подключатся в root модуле, но будет проверять код для build-logic модуля.

На данный момент реализован третий вариант.

### Прямое использование properties в settings.gradle.kts

TODO

## Tests.

### Mockk не умеет в KMP

Пока решено не отказываться от удобства Mockk и все такие тесты выносятся в `jvmTest`. Альтернативы Mockk с поддержкой
KMP есть, но выглядят слишком слабо и не внушают доверия.